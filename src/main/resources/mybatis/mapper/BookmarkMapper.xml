<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- BookmarkMapper 인터페이스와 매핑되는 MyBatis XML 매퍼 -->
<mapper namespace="com.ex.tjspring.bookmark.mapper.BookmarkMapper">

    <select id="findByUserId" resultType="com.ex.tjspring.bookmark.dto.Bookmark">
        SELECT
        b.id,                                 -- 북마크 고유 ID
        b.user_id AS userId,                 -- 사용자 ID (Bookmark DTO의 userId와 매핑)
        b.group_id AS groupId,               -- 스터디 그룹 ID
        b.created_at AS createdAt,           -- 북마크 등록일

        -- 스터디 그룹 정보 (study_groups 테이블에서 가져옴)
        sg.CATEGORY AS category,
        sg.GROUP_NAME AS groupName,
        sg.GROUP_INTRODUCTION AS groupIntroduction,
        sg.GROUP_OWNER_ID AS groupOwnerId,
        sg.CREATED_AT AS studyCreatedAt,     -- 스터디 생성일
        sg.MAX_MEMBERS AS maxMembers,
        sg.STUDY_MODE AS studyMode,
        sg.REGION AS region,
        sg.CONTACT AS contact,
        sg.THUMBNAIL AS thumbnail

        FROM user_bookmark b
        LEFT JOIN study_groups sg ON b.group_id = sg.GROUP_ID
        WHERE b.user_id = #{userId}             -- 매개변수 userId와 바인딩됨
        ORDER BY b.created_at DESC              -- 최신순 정렬
    </select>
    <insert id="insertBookmark" parameterType="com.ex.tjspring.bookmark.dto.Bookmark">
        INSERT INTO C##TJSPRING.user_bookmark (user_id, group_id, created_at)
        VALUES (#{userId}, #{groupId}, SYSDATE)
    </insert>

    <delete id="deleteBookmark">
        DELETE FROM C##TJSPRING.user_bookmark
        WHERE user_id = #{userId} AND group_id = #{groupId}
    </delete>

    <select id="getBookmarkCounts" resultType="map">
        SELECT group_id AS groupId, COUNT(*) AS bookmarkCount
        FROM C##TJSPRING.user_bookmark
        GROUP BY group_id
    </select>


</mapper>
